---
title: å¦‚ä½•æäº¤PRæ¥å‚ä¸å¼€æºé¡¹ç›®
subtitle:
date: 2024-06-12 13:50:46 +0800
lang: zh
author: Ricky Yel
show_edit_on_github: true
tags: git PR
show_tags: true
---

<!--more-->

æœ¬æ–‡ä¸»è¦æ˜¯è½¬è½½è‡ª[è¿™é‡Œ](https://blog.devstream.io/posts/open-a-pr-in-github/#52ç¬¬äºŒæ­¥å…‹éš†é¡¹ç›®ä»“åº“åˆ°æœ¬åœ°)ï¼Œåšä¸€ä¸ªå¤‡ä»½ã€‚å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘åˆ é™¤ã€‚

# ä¸€ã€æ¦‚è¿°

ç•¥

# äºŒã€ä¸ºä»€ä¹ˆè¦å‚ä¸å¼€æºé¡¹ç›®

ç•¥

# ä¸‰ã€ä¸ºä»€ä¹ˆæˆ‘æƒ³ä»‹ç»å¦‚ä½• PR

ç•¥

# å››ã€æˆ‘æƒ³å‚ä¸å¼€æºé¡¹ç›®ï¼Œæ€ä¹ˆå¼€å§‹ï¼Ÿ

ç•¥

# äº”ã€æˆ‘è¦æäº¤ PRï¼Œæ€ä¹ˆä¸Šæ‰‹ï¼Ÿ

## ç¬¬ä¸€æ­¥ï¼šFork é¡¹ç›®

ç•¥

## ç¬¬äºŒæ­¥ï¼šå…‹éš†é¡¹ç›®ä»“åº“åˆ°æœ¬åœ°

æ³¨æ„æ˜¯cloneä½ è‡ªå·±çš„forkä»“åº“ï¼Œè€Œä¸æ˜¯åŸä»“åº“ã€‚

```shell
git clone <your-fork-repo-url>

# è®¾ç½®ä¸Šæ¸¸ä»“åº“
git remote add upstream <original-repo-url>
# è®¾ç½®æ°¸ä¸pushåˆ°ä¸Šæ¸¸ä»“åº“
git remote set-url --push upstream no_push
```

è®¾ç½®å®Œåï¼Œå°±å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„remoteä»“åº“æœ‰ä¸¤ä¸ªäº†ï¼š

```shell
$ git remote -v

>>>
origin <your-fork-repo-url> (fetch)
origin <your-fork-repo-url> (push)
upstream <original-repo-url> (fetch)
upstream no_push (push)
```

è®°ä½å•°ï¼Œä½ æœ¬åœ°çš„ä»£ç å˜æ›´æ°¸è¿œåªæäº¤åˆ° originï¼Œç„¶åé€šè¿‡ origin æäº¤ Pull Request åˆ° upstreamã€‚

## ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°æœ¬åœ°åˆ†æ”¯ä»£ç å¹¶åˆ›å»ºæ–°åˆ†æ”¯

æ¯æ¬¡å¼€å‘å‰ï¼Œè®°å¾—æ›´æ–°æœ¬åœ°ä»£ç ï¼Œé¿å…å†²çªã€‚

```shell
# æ›´æ–°æœ¬åœ°ä»£ç 
git fetch upstream
git checkout main
git rebase upstream/main

# åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b <new-branch-name>
```

## ç¬¬å››æ­¥ï¼šå†™ä»£ç 

ç•¥

## ç¬¬äº”æ­¥ï¼šCommit å’Œ Push

ç•¥

## ç¬¬å…­æ­¥ï¼šå¼€ä¸€ä¸ª PR

push å®Œä»£ç åï¼Œä½ ä¼šåœ¨githubä¸Šçœ‹åˆ°ä¸€ä¸ªé»„è‰²çš„æç¤ºé‡Œé¢æœ‰æŒ‰é’® `Compare & pull request` ç‚¹å‡»å®ƒï¼Œç„¶åå¡«å†™ PR çš„æ ‡é¢˜å’Œæè¿°ï¼Œæœ€åæäº¤ PRã€‚

æˆ–è€…åˆ‡æ¢åˆ°åˆšæ‰å¼€å‘çš„åˆ†æ”¯ï¼Œç‚¹å‡» `Contribute` -> `Open pull request`ã€‚

## ç¬¬ä¸ƒæ­¥ï¼šPR åˆå…¥

å¦‚æœä½ çš„ PR å¾ˆå®Œç¾ï¼Œæ¯«æ— äº‰è®®ï¼Œé‚£ä¹ˆè¿‡ä¸äº†å¤ªé•¿æ—¶é—´ï¼Œé¡¹ç›®ç®¡ç†å‘˜ä¼šç›´æ¥åˆå…¥ä½ çš„ PRï¼Œé‚£ä¹ˆä½ è¿™ä¸ª PR çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±åˆ°æ­¤ç»“æŸäº†ã€‚

ä½†æ˜¯ï¼Œæ²¡é”™ï¼Œè¿™é‡Œæœ‰ä¸ªâ€œä½†æ˜¯â€ï¼Œä½†æ˜¯å¾€å¾€ç¬¬ä¸€æ¬¡ PR ä¸ä¼šé‚£ä¹ˆé¡ºåˆ©ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹å¯èƒ½ç»å¸¸é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œå¯¹åº”çš„è§£å†³åŠæ³•ã€‚

# å…­ã€æˆ‘æäº¤äº†ä¸€ä¸ª PRï¼Œç„¶åé‡åˆ°äº†é—®é¢˜ A,B,C,D,E,F,G,â€¦ğŸ˜­

## 6.1ã€Reviewers æäº†ä¸€äº›ä¿®æ”¹æ„è§ï¼Œæˆ‘å¦‚ä½•æ›´æ–° PRï¼Ÿ

å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æäº¤äº†ä¸€ä¸ª PR åï¼Œè¿˜éœ€è¦ç»§ç»­è¿½åŠ  commitï¼Œæ¯”å¦‚æäº¤åå‘ç°ä»£ç è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œæƒ³å†æ”¹æ”¹ï¼Œæˆ–è€… reviewers æäº†ä¸€äº›ä¿®æ”¹æ„è§ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä»£ç ã€‚

ä¸€èˆ¬æˆ‘ä»¬éµå®ˆä¸€ä¸ªçº¦å®šï¼š

1. åœ¨ review å¼€å§‹ä¹‹å‰ï¼Œæ›´æ–°ä»£ç å°½é‡ä¸å¼•å…¥æ–°çš„ commits è®°å½•ï¼Œä¹Ÿå°±æ˜¯èƒ½åˆå¹¶å°±åˆå¹¶ï¼Œä¿è¯ commits è®°å½•æ¸…æ™°ä¸”æœ‰æ„ä¹‰ï¼›
2. åœ¨ review å¼€å§‹ä¹‹åï¼Œé’ˆå¯¹ reviewers çš„ä¿®æ”¹æ„è§æ‰€äº§ç”Ÿçš„æ–° commitï¼Œå¯ä»¥ä¸å‘å‰åˆå¹¶ï¼Œè¿™æ ·èƒ½å¤Ÿè®©äºŒæ¬¡ review å·¥ä½œæ›´æœ‰é’ˆå¯¹æ€§ã€‚

ä¸è¿‡ä¸åŒç¤¾åŒºè¦æ±‚ä¸ä¸€æ ·ï¼Œå¯èƒ½æœ‰çš„å¼€æºé¡¹ç›®ä¼šè¦æ±‚ä¸€ä¸ª PR é‡Œåªèƒ½åŒ…å«ä¸€ä¸ª commitï¼Œå¤§å®¶æ ¹æ®å®é™…åœºæ™¯çµæ´»åˆ¤æ–­å³å¯ã€‚

è¯´å›å¦‚ä½•æ›´æ–° PRï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ¬åœ°ç»§ç»­ä¿®æ”¹ä»£ç ï¼Œç„¶åé€šè¿‡å’Œç¬¬ä¸€ä¸ª commit ä¸€æ ·çš„æ­¥éª¤ï¼Œæ‰§è¡Œè¿™å‡ ä¸ªå‘½ä»¤ï¼š

```shell
git add <file>
git commit -s -m "some description here"
git push origin feat-xxx
```

è¿™æ—¶å€™åˆ«çœ‹ push çš„æ˜¯ origin çš„ feat-xxx åˆ†æ”¯ï¼Œ<font color =purple>å…¶å® GitHub ä¼šå¸®ä½ æŠŠæ–°å¢çš„ commits å…¨éƒ¨è¿½åŠ åˆ°ä¸€ä¸ªæœªåˆå…¥ PR é‡Œå»</font>ã€‚æ²¡é”™ï¼Œä½ åªç®¡ä¸æ–­ pushï¼ŒPR ä¼šè‡ªåŠ¨æ›´æ–°ã€‚

## 6.2ã€Commits å¤ªå¤šæˆ–è€…è®°å½•æ··ä¹±ï¼Œå¦‚ä½•åˆå¹¶ Commitsï¼Ÿ

æœ‰æ—¶å€™æˆ‘ä»¬æäº¤ PR çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¬¡ commitï¼Œæˆ–è€… commit è®°å½•æ··ä¹±ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ `git rebase` æ¥åˆå¹¶ commitsã€‚

```shell
# é€‰æ‹©è¦åˆå¹¶çš„ commitï¼Œå‡è®¾ä¸º2ä¸ª
git rebase -i HEAD~2
```

æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¼šè¿›å…¥ä¸€ä¸ªç¼–è¾‘é¡µé¢ï¼Œé»˜è®¤æ˜¯ vim ç¼–è¾‘æ¨¡å¼ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š

```shell
pick 3114c0f docs: just for test
pick 9b7d63b docs: just for test

# Rebase d640931..9b7d63b onto d640931 (2 commands)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
```

> è¿™é‡Œæœ‰å‡ ä¸ªå‘½ä»¤ï¼š
> - `pick`ï¼šä¿ç•™è¿™ä¸ª commit
> - `reword`ï¼šä¿ç•™è¿™ä¸ª commitï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹ commit message
> - `edit`ï¼šä¿ç•™è¿™ä¸ª commitï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹ commit messageï¼Œæˆ–è€…ä¿®æ”¹ä»£ç 
> - `squash`ï¼šåˆå¹¶è¿™ä¸ª commit åˆ°ä¸Šä¸€ä¸ª commit, ä¿ç•™è¿™ä¸ª commit çš„ commit message
> - `fixup`ï¼šåˆå¹¶è¿™ä¸ª commit åˆ°ä¸Šä¸€ä¸ª commitï¼Œä½†æ˜¯ä¸ä¿ç•™è¿™ä¸ª commit çš„ commit message
> - `drop`ï¼šåˆ é™¤è¿™ä¸ª commit

<font color = blue>å¹¶ä¸”å›æ”¾çš„é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹</font>ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦åˆå¹¶ä¸¤ä¸ª commitï¼Œå¯ä»¥å°†ç¬¬äºŒä¸ª commit çš„å‘½ä»¤æ”¹ä¸º `squash`ï¼Œç„¶åä¿å­˜é€€å‡ºï¼š

```shell
pick 3114c0f docs: just for test
squash 9b7d63b docs: just for test
```

ä¿å­˜é€€å‡ºåï¼Œä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„ç¼–è¾‘é¡µé¢ï¼Œè¿™æ—¶å€™å¯ä»¥ä¿®æ”¹ commit messageï¼Œç„¶åä¿å­˜é€€å‡ºå³å¯ã€‚

## 6.3ã€PR äº§ç”Ÿäº†å†²çªï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

### 6.3.1ã€åœ¨çº¿è§£å†³å†²çª

ç•¥

### 6.3.2ã€æœ¬åœ°è§£å†³å†²çª

```shell
# æ›´æ–°æœ¬åœ°ä»£ç 
git fetch upstream
git checkout main
git rebase upstream/main

# åˆ‡æ¢åˆ°å¼€å‘åˆ†æ”¯
git checkout feat-xxx
git rebase main
```

rebase çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œç±»ä¼¼å¦‚ä¸‹çš„æ—¥å¿—ï¼š

```plaintext
First, rewinding head to replay your work on top of it...
Applying: docs: conflict test 1
Using index info to reconstruct a base tree...
M       README.md
Falling back to patching base and 3-way merge...
Auto-merging README.md
CONFLICT (content): Merge conflict in README.md
error: Failed to merge in the changes.
Patch failed at 0001 docs: conflict test 1
The copy of the patch that failed is found in: .git/rebase-apply/patch

Resolve all conflicts manually, mark them as resolved with
"git add/rm <conflicted_files>", then run "git rebase --continue".
You can instead skip this commit: run "git rebase --skip".
To abort and get back to the state before "git rebase", run "git rebase --abort".
```

è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è§£å†³å†²çªï¼Œå¹¶ä¸”ä½¿ç”¨ `git add` å‘½ä»¤æ¥æ ‡è®°å†²çªå·²ç»è§£å†³ï¼Œæœ€åæ‰§è¡Œ `git rebase --continue` æ¥ç»§ç»­ rebase è¿‡ç¨‹ã€‚

æ¨é€å˜æ›´åˆ°è¿œç¨‹ä»“åº“ï¼š

```shell
git push -f origin feat-xxx
```

## 6.4ã€CI æ£€æŸ¥ä¸è¿‡ï¼šcommit message ç›¸å…³é—®é¢˜å¦‚ä½•ä¿®å¤ï¼Ÿ

å‰é¢æˆ‘ä»¬æåˆ°è¿‡ commit message çš„è§„èŒƒï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡æäº¤ PR çš„æ—¶å€™è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ¯”å¦‚feat: xxxå…¶å®èƒ½é€šè¿‡ ci æ£€æŸ¥ï¼Œä½†æ˜¯feat: Xxxå°±ä¸è¡Œäº†ã€‚å‡è®¾ç°åœ¨æˆ‘ä»¬ä¸å°å¿ƒæäº¤äº†ä¸€ä¸ª PRï¼Œä½†æ˜¯é‡Œé¢ commit çš„ message ä¸è§„èŒƒï¼Œè¿™æ—¶å€™æ€ä¹ˆä¿®æ”¹å‘¢ï¼Ÿ

å¤ªç®€å•äº†ï¼Œç›´æ¥æ‰§è¡Œï¼š`git commit --amend`ï¼Œç„¶åä¿®æ”¹ commit message å³å¯ï¼Œæœ€åå† `git push -f origin feat-xxx`ã€‚

## 6.5ã€CI æ£€æŸ¥ä¸è¿‡ï¼šDCO(sign) é—®é¢˜å¦‚ä½•ä¿®å¤ï¼Ÿ

ç›¸å½“å¤šçš„å¼€æºé¡¹ç›®ä¼šè¦æ±‚æ‰€æœ‰åˆå…¥çš„ commits éƒ½åŒ…å«ä¸€è¡Œç±»ä¼¼è¿™æ ·çš„è®°å½•ï¼š

```shell
Signed-off-by: <Your Name> <Your Email>
```

è¿™è¡Œä¿¡æ¯ç›¸å½“äºæ˜¯å¯¹åº” commit çš„ä½œè€…ç­¾åã€‚è¦æ·»åŠ è¿™æ ·ä¸€è¡Œç­¾åå½“ç„¶å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨git commitå‘½ä»¤åé¢åŠ ä¸€ä¸ª-så‚æ•°å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚git commit -s -m "some description here"æäº¤çš„ commit å°±ä¼šå¸¦ä¸Šä½ çš„ç­¾åã€‚

å¦‚æœä½ æäº¤äº†ä¸€ä¸ª PRï¼Œä½†æ˜¯ CI æ£€æŸ¥ä¸è¿‡ï¼Œæç¤ºä½ æ²¡æœ‰ç­¾åï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ `git commit --amend -s` æ¥æ·»åŠ ç­¾åï¼Œç„¶åå† `git push -f origin feat-xxx`ã€‚

# ä¸ƒã€æœ€å

è¿™æ˜¯åŸä½œè€…è´´çš„ä¸€äº›é“¾æ¥ï¼Œè¿™é‡Œä¸€å¹¶è´´ä¸Šï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼š

- æ¬¢è¿åˆ°[æˆ‘çš„ä¸ªäººç½‘ç«™](https://www.danielhu.cn/)æˆ–è€…å¾®ä¿¡å…¬ä¼—å·â€œèƒ¡è¯´äº‘åŸç”Ÿâ€æµè§ˆæ›´å¤šæˆ‘çš„æ–‡ç« ï¼›
- æ¬¢è¿å…³æ³¨[DevStream ç¤¾åŒº](https://github.com/devstream-io)ï¼Œå’Œæˆ‘ä¸€èµ·ç©å¼€æºï¼›
- æ¬¢è¿åˆ°[DevStream å®˜æ–¹åšå®¢](https://blog.devstream.io/)æµè§ˆæ›´å¤š DevStream å›¢é˜Ÿå‘å¸ƒçš„æ–‡ç« ã€‚